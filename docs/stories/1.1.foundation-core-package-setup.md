# Story 1.1: Foundation Core Package Setup

## Status
Draft

## Story
**As a** Max for Live device developer,
**I want** a foundational `@alits/core` package with basic Live Object Model abstractions,
**so that** I can build type-safe, modern TypeScript applications that interact with Ableton Live's LiveAPI

## Acceptance Criteria
1. **AC1**: `@alits/core` package is created with proper TypeScript configuration and build setup
2. **AC2**: Basic `LiveSet` abstraction is implemented with async/await API
3. **AC3**: Core utilities for MIDI note ↔ name conversion are provided
4. **AC4**: Generalized `observeProperty<T>()` helper is implemented for RxJS observables
5. **AC5**: Package follows monorepo conventions with Jest testing setup
6. **AC6**: All code compiles to ES5 for Max 8 runtime compatibility
7. **AC7**: Package achieves ≥90% test coverage with comprehensive unit tests
8. **AC8**: Entry point exports: `import { LiveSet, Track, RackDevice, DrumPad } from '@alits/core'`

## Tasks / Subtasks
- [ ] Task 1: Create `@alits/core` package structure (AC: 1, 5)
  - [ ] Create `packages/alits-core/` directory structure
  - [ ] Set up `package.json` with proper dependencies and scripts
  - [ ] Configure `tsconfig.json` for ES5 compilation
  - [ ] Set up `jest.config.js` extending base configuration
  - [ ] Create `rollup.config.js` for library bundling
- [ ] Task 2: Implement basic `LiveSet` abstraction (AC: 2)
  - [ ] Create `LiveSet` class with async constructor
  - [ ] Implement basic LiveAPI integration
  - [ ] Add error handling for LiveAPI failures
  - [ ] Create TypeScript interfaces for LOM objects
- [ ] Task 3: Implement core utilities (AC: 3)
  - [ ] Create MIDI note ↔ name conversion functions
  - [ ] Add utility functions for common LiveAPI operations
  - [ ] Implement error handling utilities
- [ ] Task 4: Implement observability foundation (AC: 4)
  - [ ] Create `observeProperty<T>()` helper function
  - [ ] Implement RxJS Observable wrappers
  - [ ] Add proper cleanup and unsubscription logic
- [ ] Task 5: Set up comprehensive testing (AC: 7)
  - [ ] Create mock LiveAPI implementations
  - [ ] Write unit tests for all public methods
  - [ ] Add Observable testing utilities
  - [ ] Achieve ≥90% test coverage
- [ ] Task 6: Configure ES5 compilation (AC: 6)
  - [ ] Verify TypeScript compilation to ES5
  - [ ] Test compatibility with Max 8 runtime
  - [ ] Add polyfills if needed for async/await
- [ ] Task 7: Set up package exports (AC: 8)
  - [ ] Configure proper entry point in `package.json`
  - [ ] Create index file with all exports
  - [ ] Verify import statements work correctly

## Dev Notes

### Previous Story Insights
No previous stories exist - this is the first story in Epic 1.

### Data Models
**LiveSet Abstraction** [Source: architecture-target.md#foundation-packages]:
- Root abstraction representing the main Live set
- Provides access to tracks, scenes, and other LOM objects
- Entry point: `import { LiveSet, Track, RackDevice, DrumPad } from '@alits/core'`

**Core Utilities** [Source: architecture-target.md#foundation-packages]:
- MIDI note ↔ name conversion functions
- Error handling utilities
- Common LiveAPI operation helpers

### API Specifications
**LiveAPI Integration** [Source: architecture.md#data-models-and-apis]:
- Async/await promise-based API
- TypeScript interfaces for LOM objects (`LiveSet`, `Track`, `Device`, `RackDevice`, `DrumPad`)
- No external string paths - all API calls work with object references

**Observable API Design** [Source: architecture-target.md#observability-reactive-patterns]:
- `observeProperty<T>(path: string, prop: string): Observable<T>` helper
- Naming convention: `observeX()` methods for all mutable properties
- Proper cleanup and unsubscription logic required

### Component Specifications
**Package Structure** [Source: brief-coding-conventions.md#monorepo-structure-conventions]:
```
packages/alits-core/
├── src/                    # Source TypeScript files
├── tests/                  # Test files and utilities
├── dist/                   # Built output (generated)
├── jest.config.js          # Package-specific Jest config
├── package.json            # Package dependencies and scripts
├── tsconfig.json           # TypeScript configuration
└── README.md               # Package documentation
```

### File Locations
**Package Location**: `packages/alits-core/` [Source: brief-coding-conventions.md#package-structure-standards]
**Test Location**: `packages/alits-core/tests/` [Source: brief-coding-conventions.md#test-organization]
**Source Location**: `packages/alits-core/src/` [Source: brief-coding-conventions.md#package-structure-standards]

### Testing Requirements
**Testing Strategy** [Source: brief-coding-conventions.md#testing-strategy]:
- Jest + ts-jest with Turborepo integration
- Package-level Jest configuration extending base config
- Co-located test files with source code
- Mock LiveAPI implementations for deterministic tests
- ≥90% test coverage requirement
- Observable testing utilities

**Test Organization** [Source: brief-coding-conventions.md#test-organization]:
- Automated tests co-located with source code
- Use `__tests__` directories for complex test suites
- Mock LiveAPI implementations in test utilities
- Shared test utilities in `@alits/test-utils` package

### Technical Constraints
**Runtime Compatibility** [Source: architecture.md#actual-tech-stack]:
- Node.js 22.x (Active LTS) for build/test
- TypeScript 5.6 with strict mode
- ES5 compilation target for Max 8 runtime
- Max 8 (ES5 JavaScript) target runtime for `.amxd` devices

**Build System** [Source: architecture.md#actual-tech-stack]:
- Rollup for library bundling
- Turborepo for monorepo task orchestration
- pnpm for package management

**Coding Standards** [Source: brief-coding-conventions.md#typescript-conventions]:
- camelCase for methods and properties
- PascalCase for class names and type definitions
- Explicit return types for all methods
- Async/await for asynchronous operations
- No external string paths in public API

### Testing
**Testing Standards** [Source: brief-coding-conventions.md#testing-strategy]:
- **Test File Location**: `packages/alits-core/tests/` and co-located with source
- **Test Standards**: Jest + ts-jest with comprehensive mocking
- **Testing Frameworks**: Jest for unit tests, RxJS testing utilities for observables
- **Coverage Requirements**: ≥90% test coverage for core abstractions
- **Mock Strategy**: Comprehensive LiveAPI test doubles
- **Test Organization**: Package-level Jest config extending shared base

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-12 | 1.0 | Initial story creation for Epic 1 Foundation | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*This section will be populated by the QA agent after implementation review*
